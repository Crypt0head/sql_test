# DAG Parser ‚Äî –ü–∞—Ä—Å–µ—Ä SQL JOIN-—Å–≤—è–∑–µ–π

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏–∑ SQL-—Ñ–∞–π–ª–æ–≤ –≤ DAG-–ø—Ä–æ–µ–∫—Ç–∞—Ö. –ü–∞—Ä—Å–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ JOIN-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –æ —Å–≤—è–∑—è—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –≤ Confluence.

---

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ó–∞–≥—Ä—É–∑–∫–∞ DAG-–∞—Ä—Ö–∏–≤–æ–≤** –∏–∑ GitLab –ø–æ URL
- **–ü–∞—Ä—Å–∏–Ω–≥ SQL-—Ñ–∞–π–ª–æ–≤** —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ JOIN-–æ–ø–µ—Ä–∞—Ü–∏–π
- **–†–µ–∑–æ–ª–≤–∏–Ω–≥ –∞–ª–∏–∞—Å–æ–≤ —Ç–∞–±–ª–∏—Ü** –∏–∑ YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π —Å –ø–æ–º–æ—â—å—é —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (SHA-384)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Confluence** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Confluence

---

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
sqlglot
atlassian-python-api
hydra-core
omegaconf
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏

- `extract_joins` ‚Äî –º–æ–¥—É–ª—å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JOIN-–≤—ã—Ä–∞–∂–µ–Ω–∏–π (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª–∞—Å—Å `JoinParser`)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `cfg/config.json` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```json
{
  "DirPaths": ["./data/"],
  "Urls": [],
  "ResultPath": "result.txt",
  "ZipExtractionMembers": [],
  "RemovePreloadedFiles": false,
  "GitlabSettings": {
    "GitlabToken": ""
  },
  "ConfluenceSettings": {
    "Url": "",
    "Username": "",
    "Password": "",
    "SpaceKey": "",
    "PageID": "",
    "CertPath": ""
  }
}
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `DirPaths` | –°–ø–∏—Å–æ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è SQL-—Ñ–∞–π–ª–æ–≤ |
| `Urls` | –°–ø–∏—Å–æ–∫ URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ DAG-–∞—Ä—Ö–∏–≤–æ–≤ –∏–∑ GitLab |
| `ResultPath` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ |
| `ZipExtractionMembers` | –§–∏–ª—å—Ç—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –∞—Ä—Ö–∏–≤–∞ |
| `RemovePreloadedFiles` | –£–¥–∞–ª—è—Ç—å –∞—Ä—Ö–∏–≤—ã –ø–æ—Å–ª–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ |
| `GitlabSettings.GitlabToken` | –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ GitLab API |
| `ConfluenceSettings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Confluence (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û) |

### Hydra-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Hydra –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `cfg/config.yaml`.

## üöÄ –ó–∞–ø—É—Å–∫

```bash
python parser.py
```

---

## üìä –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `result.txt`) –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
<hash>;<dag_name>;<table1>;<table2>;<join_type> JOIN;<conditions>
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏

```
a1b2c3...;my_dag;schema.table_a;schema.table_b;INNER JOIN;t1.id=t2.id
```

---

## üìà –û—Ç—á—ë—Ç –æ —Ä–∞–±–æ—Ç–µ

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

```
============================================================
–û–¢–ß–Å–¢ –û –†–ê–ë–û–¢–ï –ü–ê–†–°–ï–†–ê
============================================================
JOIN'–æ–≤ –Ω–∞–π–¥–µ–Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º: 150
–í—Å–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ —Å–≤—è–∑–µ–π: 120
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π: 95
–û–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ (–¥—É–±–ª–∏–∫–∞—Ç–æ–≤): 25
============================================================
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Confluence

–ü—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Confluence (`SpaceKey` –∏ `PageID`):

1. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. **–û–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è** –Ω–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏
3. **–ü—É–±–ª–∏–∫—É–µ—Ç—Å—è** –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–∏–µ
4. **–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** HTML-—Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Confluence

---

## üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ YAML-–∞–ª–∏–∞—Å–æ–≤

–ü–∞—Ä—Å–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `notebook.yaml`
- `test.yaml`
- `dev.yaml`
- `prod.yaml`
- `tables/tables.yaml`
- `tables/table_conf.yaml`
- `tables/tables_conf.yaml`

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
- `${..schema}` / `${...schema}`
- `${..prefix}` / `${...prefix}`

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –¢–∞–±–ª–∏—Ü—ã —Å –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (`${...}`) –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `DUAL` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ SQL

